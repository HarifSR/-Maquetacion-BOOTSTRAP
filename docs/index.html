<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Tienda Online</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://kit.fontawesome.com/a2e0f4e6a4.js" crossorigin="anonymous"></script>
</head>
<body>

  
  <div class="container mt-3">
    <div class="position-relative">
      <div id="carousel" class="carousel slide carousel-fade mb-3 rounded overflow-hidden" data-bs-ride="carousel" data-bs-interval="3000">
  <div class="carousel-inner">
    <div class="carousel-item active">
      <img src="img/electronica-1.jpg" class="d-block w-100 img-fluid" style="height: 400px; object-fit: cover;" alt="Banner 1">
    </div>
    <div class="carousel-item">
      <img src="img/electronica-2.jpg" class="d-block w-100 img-fluid" style="max-height: 400px; object-fit: cover;" alt="Banner 2">
    </div>
  </div>

  <button class="carousel-control-prev" type="button" data-bs-target="#carousel" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Anterior</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#carousel" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Siguiente</span>
  </button>
</div>

      
<div class="position-absolute top-0 end-0 p-4" style="z-index: 1050;">
  <button class="btn btn-outline-dark position-relative">
    <i class="bi bi-cart3"></i>
    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
      1
    </span>
  </button>
</div>
    
    <div class="row mt-4">
      
<body style="background-color: #F8F1E8;">

  <div class="col-sm-3 mb-4">
  <div class="card mb-3" style="border: 2px solid #0A2A43;">
    <h5 class="card-title fw-bold" style="color: #0A2A43;">CATEGORÍAS</h5>
<ul class="list-unstyled" id="listaCategorias">
</ul>

    </div>
  </div>

  <div class="text-center">
    <img src="img/logo2.png" alt="Café Infinito" class="img-fluid" style="max-width: 100%; height: auto;">
  </div>
</div>

      
      <div class="col-sm-9">
        <div class="row g-4" id="contenedorProductos"></div>
      </div>
    </div>

    
    <footer class="text-center py-4 mt-5 border-top">
      Diseñado por: Harif Ricardo Samayoa Ruiz - 1890-22-3562
    </footer>
  </div>

  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
  const API_URL = "https://backcvbgtmdesa.azurewebsites.net/api/productos";
  const contenedor = document.getElementById("contenedorProductos");
  const contadorCarrito = document.querySelector(".badge");
  let carrito = 0;

  
  const USE_SERVER_FILTER = false;

 
  let allProducts = [];

  const formatear = (n) => `$${parseFloat(n).toFixed(2)}`;

 
  function obtenerCategoria(producto) {
    
    return (
      producto.Categoria ||
      producto.CategoriaNombre ||
      producto.CategoriaName ||
      producto.categoria ||
      producto.category ||
      (producto.CategoriaId && producto.CategoriaId.Nombre) ||
      ""
    );
  }

  function precioHTML(producto) {
    if (producto.EnOferta && producto.PrecioOferta != null) {
      return `
        <span class="text-danger fw-bold">${formatear(producto.PrecioOferta)}</span><br>
        <small class="text-muted text-decoration-line-through">${formatear(producto.Precio)}</small>
      `;
    }
    return `<span class="fw-bold">${formatear(producto.Precio)}</span>`;
  }

  function pintarProductos(lista) {
    contenedor.innerHTML = "";
    if (!lista || lista.length === 0) {
      contenedor.innerHTML = `
        <div class="alert alert-warning">No hay productos en esta categoría.</div>
      `;
      return;
    }

    lista.forEach((producto) => {
      const col = document.createElement("div");
      col.className = "col-sm-12 col-md-4 mb-4";
      col.innerHTML = `
        <div class="card h-100" style="border: 2px solid #0A2A43;">
          <img src="${producto.Imagen}" class="card-img-top img-fluid" style="height: 250px; object-fit: cover;" alt="${producto.Nombre}">
          <div class="card-body d-flex flex-column">
            <h6 class="card-title">${producto.Nombre}</h6>
            <p class="card-text">${producto.Descripcion ?? ""}</p>
            <p class="card-text">${precioHTML(producto)}</p>
            <button class="btn btn-primary mt-auto agregarCarrito" style="background-color: #0A2A43; color: white;">
              Agregar al carrito
            </button>
          </div>
        </div>
      `;
      col.querySelector(".agregarCarrito").addEventListener("click", () => {
        carrito++;
        contadorCarrito.textContent = carrito;
      });
      contenedor.appendChild(col);
    });
  }

  async function cargarProductos(categoriaSeleccionada = "Todas") {
    try {
      contenedor.innerHTML = `<div class="text-center py-5">Cargando…</div>`;

      if (USE_SERVER_FILTER && categoriaSeleccionada !== "Todas") {
        
        const urlConFiltro = API_URL + (API_URL.includes("?") ? "&" : "?") +
          "categoria=" + encodeURIComponent(categoriaSeleccionada);
        const resp = await fetch(urlConFiltro);
        const productos = await resp.json();
        pintarProductos(productos);
        return;
      }

      
      if (allProducts.length === 0) {
        const resp = await fetch(API_URL);
        allProducts = await resp.json();
      }

      const lista = (categoriaSeleccionada === "Todas")
        ? allProducts
        : allProducts.filter(p => {
            const cat = String(obtenerCategoria(p)).toLowerCase().trim();
            return cat === categoriaSeleccionada.toLowerCase();
          });

      pintarProductos(lista);
    } catch (error) {
      console.error("Error al cargar productos:", error);
      contenedor.innerHTML = '<div class="alert alert-danger">No se pudieron cargar los productos.</div>';
    }
  }

  function activarCategoriaUI(enlaceActivo) {
    document.querySelectorAll("#listaCategorias .categoria").forEach(a => {
      a.classList.remove("fw-bold", "text-primary");
    });
    enlaceActivo.classList.add("fw-bold", "text-primary");
  }

  document.querySelectorAll("#listaCategorias .categoria").forEach(a => {
    a.addEventListener("click", (e) => {
      e.preventDefault();
      const cat = a.dataset.cat;
      activarCategoriaUI(a);
      cargarProductos(cat);
    });
  });

 
  const inicial = document.querySelector('#listaCategorias .categoria[data-cat="Todas"]') || document.querySelector('#listaCategorias .categoria');
  if (inicial) activarCategoriaUI(inicial);
  cargarProductos("Todas");
</script>



</body>
</html>
